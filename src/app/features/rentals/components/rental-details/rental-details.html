<div class="container">
  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-state">
    <div class="spinner">â³</div>
    <p>Loading rental details...</p>
  </div>
  }

  <!-- Rental Details Content -->
  @if (!isLoading() && rental()) {
  <div class="content">
    <!-- Header -->
    <div class="header">
      <button class="back-btn" (click)="goBack()">â† Back to My Rentals</button>
      <div class="logo">Rent<span>Mate</span></div>
    </div>

    <!-- Status Banner -->
    <div class="status-banner" [style.background-color]="getStatusColor(rental().status) + '20'"
      [style.border-color]="getStatusColor(rental().status)">
      <div class="status-icon">{{ getStatusIcon(rental().status) }}</div>
      <div class="status-info">
        <h2>Rental Request {{ rental().status }}</h2>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="details-grid">
      <!-- Left Column -->
      <div class="left-column">
        <!-- Item Details Card -->
        <div class="card">
          <h3>ğŸ“¦ Item Details</h3>
          <div class="item-preview">
            <div class="item-icon">{{ itemDetails()?.icon || 'ğŸ“¦' }}</div>
            <div class="item-info">
              <h4>{{ itemDetails()?.title || 'Loading...' }}</h4>
              <p class="daily-rate">${{ itemDetails()?.rentalPrice || 0 }}/day</p>
            </div>
          </div>
        </div>

        <!-- Rental Period Card -->
        <div class="card">
          <h3>ğŸ“… Rental Period</h3>
          <div class="detail-row">
            <span class="label">Start Date</span>
            <span class="value">{{ formatDate(rental().startDate) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">End Date</span>
            <span class="value">{{ formatDate(rental().endDate) }}</span>
          </div>
          <div class="detail-row highlight">
            <span class="label">Duration</span>
            <span class="value">{{ rentalDays() }} Days</span>
          </div>
        </div>

        <!-- Timeline Card -->
        <div class="card">
          <h3>ğŸ“ Request Timeline</h3>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-dot active"></div>
              <div class="timeline-content">
                <p class="timeline-title">Request Created</p>
                <p class="timeline-date">{{ formatDate(rental().createdDate) }}</p>
              </div>
            </div>
            <div class="timeline-item" [class.active]="rental().status !== 'Pending'">
              <div class="timeline-dot" [class.active]="rental().status !== 'Pending'"></div>
              <div class="timeline-content">
                <p class="timeline-title">Owner Response</p>
                @if (rental().status !== 'Pending') {
                <p class="timeline-date">{{ formatDate(rental().lastModifiedDate) }}</p>
                } @else {
                <p class="timeline-date">Pending...</p>
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="right-column">
        <!-- Price Summary Card -->
        <div class="card summary-card">
          <h3>ğŸ’° Price Summary</h3>

          <div class="duration-badge">
            <div class="days">{{ rentalDays() }}</div>
            <div class="label">Days</div>
          </div>

          <div class="price-breakdown">
            <div class="price-row">
              <span>Daily Rate</span>
              <span class="amount">${{ (rental().rentalPrice / rentalDays()).toFixed(2) }}</span>
            </div>
            <div class="price-row highlight-row">
              <span>Subtotal</span>
              <span class="amount">${{ rental().rentalPrice.toFixed(2) }}</span>
            </div>
            <div class="price-row">
              <span>Deposit (15%)</span>
              <span class="amount">${{ rental().depositAmount.toFixed(2) }}</span>
            </div>
            <div class="price-row total">
              <span>Total Amount</span>
              <span class="amount">${{ rental().totalPrice.toFixed(2) }}</span>
            </div>
          </div>
        </div>
       <!-- Status Info Card -->
        <div class="card status-info-card">
          <h3>ğŸ“‹ What's Next?</h3>

          @switch (rental().status) {
          @case ('Pending') {
          <div class="status-message pending">
            <p><strong>â³ Waiting for Owner Approval</strong></p>
             <p class="info-note">ğŸ“¦ Delivery cost will be calculated and added to your total soon.</p>
            <p>Your rental request has been sent. You'll receive a notification once they respond.</p>
          </div>

          <!-- Cancel Button -->
           <button 
                  class="btn-cancel" 
                  (click)="cancelRental()"
                  [disabled]="isCancelling()"
                >
                  @if (isCancelling()) {
                    <span>Cancelling...</span>
                  } @else {
                    <span>ğŸš« Cancel Request</span>
                  }
                </button>
          }
          @case ('Approved') {
          <div class="status-message approved">
            <p><strong>âœ… Request Approved!</strong></p>
            <p>Great news! The owner has approved your rental request.</p>
          </div>
          }
          @case ('Rejected') {
          <div class="status-message rejected">
            <p><strong>âŒ Request Rejected</strong></p>
            <p>Unfortunately, the owner couldn't approve your request.</p>
          </div>
          }
          }
        </div>
      </div>
    </div>
  </div>
  }
</div>